<!DOCTYPE html><html><head><title>Scanamo: DynamoFormat</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Scanamo Contributors" /><meta name="description" content="Scanamo: simpler DynamoDB access for Scala" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="Scanamo: DynamoFormat" /><meta name="title" property="og:title" content="Scanamo: DynamoFormat" /><meta name="og:site_name" content="Scanamo" /><meta name="og:url" content="http://www.scanamo.org/" /><meta name="og:type" content="website" /><meta name="og:description" content="Scanamo: simpler DynamoDB access for Scala" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Scanamo: DynamoFormat" /><meta name="twitter:image" content="https://www.scanamo.org/img/poster.png" /><meta name="twitter:description" content="Scanamo: simpler DynamoDB access for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/monokai.css" /><link rel="stylesheet" href="/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"></div><span>Scanamo</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/operations.html" title="Operations" class="drop-nested">Operations</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/operations.html#put-and-get" title="Put and Get" class="">Put and Get</a> <a href="/operations.html#delete" title="Delete" class="">Delete</a> <a href="/operations.html#update" title="Update" class="">Update</a> <a href="/operations.html#scan" title="Scan" class="">Scan</a> <a href="/operations.html#query" title="Query" class="">Query</a></div></div> <div class="sidebar-nav-item  "><a href="/batch-operations.html" title="Batch Operations" class="">Batch Operations</a></div> <div class="sidebar-nav-item  "><a href="/conditional-operations.html" title="Conditional Operations" class="">Conditional Operations</a></div> <div class="sidebar-nav-item  "><a href="/filters.html" title="Filters" class="">Filters</a></div> <div class="sidebar-nav-item  "><a href="/using-indexes.html" title="Using Indexes" class="">Using Indexes</a></div> <div class="sidebar-nav-item active open"><a href="/dynamo-format.html" title="DynamoFormat" class="drop-nested">DynamoFormat</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/dynamo-format.html#custom-formats" title="Custom Formats" class="">Custom Formats</a></div></div> <div class="sidebar-nav-item  "><a href="/asynchronous.html" title="Asynchronous Requests" class="">Asynchronous Requests</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li><li id="gh-eyes-item" class="hidden-xs to-uppercase"><a href="https://github.com/scanamo/scanamo" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs to-uppercase"><a href="https://github.com/scanamo/scanamo" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="scanamo" data-github-repo="scanamo"><div class="content-wrapper"><section><h2 id="dynamoformat">DynamoFormat</h2>

<p>Scanamo uses the <code class="highlighter-rouge">DynamoFormat</code> type class to define how to read and write different types to DynamoDB.</p>

<p>Many common types have a <code class="highlighter-rouge">DynamoFormat</code> provided by Scanamo. For a full list see of those supported, you can look at the companion object.</p>

<p>Scanamo also supports automatically deriving formats for case classes and sealed trait families where all the contained types have a defined or derivable <code class="highlighter-rouge">DynamoFormat</code>.</p>

<h3 id="automatic-derivation">Automatic Derivation</h3>

<p>Scanamo can automatically derive <code class="highlighter-rouge">DynamoFormat</code> for case classes (as long as all its members can also be derived). Ex:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scanamo._</span>
<span class="k">import</span> <span class="nn">org.scanamo.generic.auto._</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Farm</span><span class="o">(</span><span class="n">animals</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Farmer</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">farm</span><span class="k">:</span> <span class="kt">Farm</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">table</span> <span class="k">=</span> <span class="nc">Table</span><span class="o">[</span><span class="kt">Farmer</span><span class="o">](</span><span class="s">"farmer"</span><span class="o">)</span>
<span class="nv">table</span><span class="o">.</span><span class="py">putAll</span><span class="o">(</span>
    <span class="nc">Set</span><span class="o">(</span>
        <span class="nc">Farmer</span><span class="o">(</span><span class="s">"McDonald"</span><span class="o">,</span> <span class="mi">156L</span><span class="o">,</span> <span class="nc">Farm</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">"sheep"</span><span class="o">,</span> <span class="s">"cow"</span><span class="o">))),</span>
        <span class="nc">Farmer</span><span class="o">(</span><span class="s">"Boggis"</span><span class="o">,</span> <span class="mi">43L</span><span class="o">,</span> <span class="nc">Farm</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">"chicken"</span><span class="o">)))</span>
    <span class="o">)</span>
<span class="o">)</span>
</code></pre></div></div>

<h3 id="semi-automatic-derivation">Semi-automatic Derivation</h3>

<p>Scanamo offers a convenient way (semi-automatic) to derive <code class="highlighter-rouge">DynamoFormat</code> in your code. 
Ex:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scanamo._</span>
<span class="k">import</span> <span class="nn">org.scanamo.generic.semiauto._</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Farm</span><span class="o">(</span><span class="n">animals</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Farmer</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">farm</span><span class="k">:</span> <span class="kt">Farm</span><span class="o">)</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="nv">formatFarm</span><span class="k">:</span> <span class="kt">DynamoFormat</span><span class="o">[</span><span class="kt">Farm</span><span class="o">]</span> <span class="k">=</span> <span class="n">deriveDynamoFormat</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="nv">formatFarmer</span><span class="k">:</span> <span class="kt">DynamoFormat</span><span class="o">[</span><span class="kt">Farmer</span><span class="o">]</span> <span class="k">=</span> <span class="n">deriveDynamoFormat</span>
</code></pre></div></div>

<h3 id="custom-formats">Custom Formats</h3>

<p>It’s also possible to define a serialisation format for types which Scanamo doesn’t already support and can’t derive. Normally this involves using the <code class="highlighter-rouge">DynamoFormat.xmap</code> or <code class="highlighter-rouge">DynamoFormat.coercedXmap</code> to translate between the type and one Scanamo does already know about.</p>

<p>For example, to store Joda <code class="highlighter-rouge">DateTime</code> objects as ISO <code class="highlighter-rouge">String</code>s in Dynamo:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.joda.time._</span>
<span class="k">import</span> <span class="nn">org.scanamo._</span>
<span class="k">import</span> <span class="nn">org.scanamo.generic.auto._</span>
<span class="k">import</span> <span class="nn">software.amazon.awssdk.services.dynamodb.model.ScalarAttributeType._</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Foo</span><span class="o">(</span><span class="n">dateTime</span><span class="k">:</span> <span class="kt">DateTime</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">client</span> <span class="k">=</span> <span class="nv">LocalDynamoDB</span><span class="o">.</span><span class="py">syncClient</span><span class="o">()</span>
<span class="c1">// client: software.amazon.awssdk.services.dynamodb.DynamoDbClient = software.amazon.awssdk.services.dynamodb.DefaultDynamoDbClient@6c36834d</span>
<span class="k">val</span> <span class="nv">scanamo</span> <span class="k">=</span> <span class="nc">Scanamo</span><span class="o">(</span><span class="n">client</span><span class="o">)</span>
<span class="c1">// scanamo: Scanamo = org.scanamo.Scanamo@137d7627</span>

<span class="nv">LocalDynamoDB</span><span class="o">.</span><span class="py">createTable</span><span class="o">(</span><span class="n">client</span><span class="o">)(</span><span class="s">"foo"</span><span class="o">)(</span><span class="s">"dateTime"</span> <span class="o">-&gt;</span> <span class="n">S</span><span class="o">)</span>
<span class="c1">// res3: software.amazon.awssdk.services.dynamodb.model.CreateTableResponse = CreateTableResponse(TableDescription=TableDescription(AttributeDefinitions=[AttributeDefinition(AttributeName=dateTime, AttributeType=S)], TableName=foo, KeySchema=[KeySchemaElement(AttributeName=dateTime, KeyType=HASH)], TableStatus=ACTIVE, CreationDateTime=2021-02-18T04:37:25.499Z, ProvisionedThroughput=ProvisionedThroughputDescription(LastIncreaseDateTime=1970-01-01T00:00:00Z, LastDecreaseDateTime=1970-01-01T00:00:00Z, NumberOfDecreasesToday=0, ReadCapacityUnits=1, WriteCapacityUnits=1), TableSizeBytes=0, ItemCount=0, TableArn=arn:aws:dynamodb:ddblocal:000000000000:table/foo))</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="nv">jodaStringFormat</span> <span class="k">=</span> <span class="nv">DynamoFormat</span><span class="o">.</span><span class="py">coercedXmap</span><span class="o">[</span><span class="kt">DateTime</span>, <span class="kt">String</span>, <span class="kt">IllegalArgumentException</span><span class="o">](</span>
  <span class="nv">DateTime</span><span class="o">.</span><span class="py">parse</span><span class="o">(</span><span class="k">_</span><span class="o">).</span><span class="py">withZone</span><span class="o">(</span><span class="nv">DateTimeZone</span><span class="o">.</span><span class="py">UTC</span><span class="o">),</span>
  <span class="nv">_</span><span class="o">.</span><span class="py">toString</span>
<span class="o">)</span>
<span class="c1">// jodaStringFormat: DynamoFormat[DateTime] = org.scanamo.DynamoFormat$$anon$4@2a0e3a05</span>

<span class="k">val</span> <span class="nv">fooTable</span> <span class="k">=</span> <span class="nc">Table</span><span class="o">[</span><span class="kt">Foo</span><span class="o">](</span><span class="s">"foo"</span><span class="o">)</span>
<span class="c1">// fooTable: Table[Foo] = Table("foo")</span>

<span class="nv">scanamo</span><span class="o">.</span><span class="py">exec</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">{</span>
    <span class="k">_</span>           <span class="k">&lt;-</span> <span class="nv">fooTable</span><span class="o">.</span><span class="py">put</span><span class="o">(</span><span class="nc">Foo</span><span class="o">(</span><span class="k">new</span> <span class="nc">DateTime</span><span class="o">(</span><span class="mi">0</span><span class="o">)))</span>
    <span class="n">results</span>     <span class="k">&lt;-</span> <span class="nv">fooTable</span><span class="o">.</span><span class="py">scan</span><span class="o">()</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">results</span>
<span class="o">}.</span><span class="py">toList</span>
<span class="c1">// res4: List[Either[DynamoReadError, Foo]] = List(</span>
<span class="c1">//   Right(Foo(1970-01-01T00:00:00.000Z))</span>
<span class="c1">// )</span>
</code></pre></div></div>

<h3 id="formats-for-refined-types">Formats for Refined Types</h3>

<p>Scanamo supports Scala refined types via the <code class="highlighter-rouge">scanamo-refined</code> module, helping you to define custom formats
for types built using the predicates provided by the <a href="https://github.com/fthomas/refined">refined</a> project.
Refined types give an extra layer of type safety to our programs making the compilation fail when we try to
assign wrong values to them.</p>

<p>To use them in your project you will need to include the dependency in your project:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>libraryDependencies += "org.scanamo" %% "scanamo-refined" % "x.y.z"
</code></pre></div></div>

<p>And then import the support for refined types and define your model:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scanamo._</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined._</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.api.Refined</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.auto._</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.numeric._</span>
<span class="k">import</span> <span class="nn">software.amazon.awssdk.services.dynamodb.model.ScalarAttributeType._</span>

<span class="k">val</span> <span class="nv">client</span> <span class="k">=</span> <span class="nv">LocalDynamoDB</span><span class="o">.</span><span class="py">syncClient</span><span class="o">()</span>
<span class="k">val</span> <span class="nv">scanamo</span> <span class="k">=</span> <span class="nc">Scanamo</span><span class="o">(</span><span class="n">client</span><span class="o">)</span>

<span class="k">type</span> <span class="kt">PosInt</span> <span class="o">=</span> <span class="nc">Int</span> <span class="nc">Refined</span> <span class="nc">Positive</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Customer</span><span class="o">(</span><span class="n">age</span><span class="k">:</span> <span class="kt">PosInt</span><span class="o">)</span>

<span class="nv">LocalDynamoDB</span><span class="o">.</span><span class="py">createTable</span><span class="o">(</span><span class="n">client</span><span class="o">)(</span><span class="s">"Customer"</span><span class="o">)(</span><span class="s">"age"</span> <span class="o">-&gt;</span> <span class="n">N</span><span class="o">)</span>
</code></pre></div></div>

<p>You just now use it like if the type <code class="highlighter-rouge">PosInt</code> was natively supported by <code class="highlighter-rouge">scanamo</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scanamo.refined._</span>
<span class="k">import</span> <span class="nn">org.scanamo.generic.auto._</span>

<span class="k">val</span> <span class="nv">customerTable</span> <span class="k">=</span> <span class="nc">Table</span><span class="o">[</span><span class="kt">Customer</span><span class="o">](</span><span class="s">"Customer"</span><span class="o">)</span>
<span class="c1">// customerTable: Table[Customer] = Table("Customer")</span>
<span class="nv">scanamo</span><span class="o">.</span><span class="py">exec</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">{</span>
    <span class="k">_</span>       <span class="k">&lt;-</span> <span class="nv">customerTable</span><span class="o">.</span><span class="py">put</span><span class="o">(</span><span class="nc">Customer</span><span class="o">(</span><span class="mi">67</span><span class="o">))</span>
    <span class="n">results</span> <span class="k">&lt;-</span> <span class="nv">customerTable</span><span class="o">.</span><span class="py">scan</span><span class="o">()</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">results</span>
<span class="o">}.</span><span class="py">toList</span>
<span class="c1">// res7: List[Either[DynamoReadError, Customer]] = List(Right(Customer(67)))</span>
</code></pre></div></div>

<h3 id="derived-formats">Derived Formats</h3>

<p>Scanamo uses <a href="https://magnolia.work/opensource/magnolia">magnolia</a> and implicit derivation to automatically derive <code class="highlighter-rouge">DynamoFormat</code>s for case classes and sealed trait families. You may also see or hear sealed trait families referred to as Algebraic Data Types (ADTs) and co-products. Here is an example that could be used to support event sourcing (assuming a table with a partition key of <code class="highlighter-rouge">id</code> and sort key <code class="highlighter-rouge">seqNo</code>):</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">java.util.UUID</span>

<span class="k">import</span> <span class="nn">org.scanamo._</span>

<span class="c1">// Sealed trait family for events.</span>
<span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Event</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Create</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Event</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Delete</span><span class="o">(</span><span class="n">reason</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Event</span>

<span class="c1">// An event envelope that wraps events.</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">EventEnvelope</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">UUID</span><span class="o">,</span> <span class="n">seqNo</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">event</span><span class="k">:</span> <span class="kt">Event</span><span class="o">)</span>

<span class="c1">// Example instantiations.</span>
<span class="k">val</span> <span class="nv">id</span> <span class="k">=</span> <span class="nv">UUID</span><span class="o">.</span><span class="py">fromString</span><span class="o">(</span><span class="s">"9e5fd6e9-65ef-472c-ad89-e5fe658f14c6"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">create</span> <span class="k">=</span> <span class="nc">EventEnvelope</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nc">Create</span><span class="o">(</span><span class="s">"Something"</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">delete</span> <span class="k">=</span> <span class="nc">EventEnvelope</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">Delete</span><span class="o">(</span><span class="s">"Oops"</span><span class="o">))</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scanamo._</span>
<span class="k">import</span> <span class="nn">org.scanamo.generic.auto._</span>

<span class="k">val</span> <span class="nv">attributeValue</span> <span class="k">=</span> <span class="nc">DynamoFormat</span><span class="o">[</span><span class="kt">EventEnvelope</span><span class="o">].</span><span class="py">write</span><span class="o">(</span><span class="n">create</span><span class="o">)</span>
<span class="c1">// attributeValue: DynamoValue = DynObject(</span>
<span class="c1">//   Pure(</span>
<span class="c1">//     Map(</span>
<span class="c1">//       "event" -&gt; DynObject(</span>
<span class="c1">//         Pure(</span>
<span class="c1">//           Map(</span>
<span class="c1">//             "Create" -&gt; DynObject(Pure(Map("name" -&gt; DynString("Something"))))</span>
<span class="c1">//           )</span>
<span class="c1">//         )</span>
<span class="c1">//       ),</span>
<span class="c1">//       "seqNo" -&gt; DynNum("0"),</span>
<span class="c1">//       "id" -&gt; DynString("9e5fd6e9-65ef-472c-ad89-e5fe658f14c6")</span>
<span class="c1">//     )</span>
<span class="c1">//   )</span>
<span class="c1">// )</span>

<span class="k">val</span> <span class="nv">dynamoRecord</span> <span class="k">=</span> <span class="nc">DynamoFormat</span><span class="o">[</span><span class="kt">EventEnvelope</span><span class="o">].</span><span class="py">read</span><span class="o">(</span><span class="n">attributeValue</span><span class="o">)</span>
<span class="c1">// dynamoRecord: Either[DynamoReadError, EventEnvelope] = Right(</span>
<span class="c1">//   EventEnvelope(9e5fd6e9-65ef-472c-ad89-e5fe658f14c6, 0, Create("Something"))</span>
<span class="c1">// )</span>
</code></pre></div></div>

<p>If you look carefully at the attribute value (pretty-printed below) then you can see that the envelope (or wrapper) is necessary. This is because Scanamo writes the sealed trait family and associated case classes into a map. This allows Scanamo to use the map key to disambiguate between the sub-classes when reading attribute values. This makes sense and works well for most use cases, but it does mean you cannot persist an sealed trait family directly (i.e. without an envelope or wrapper) using automatic derivation because partition keys do not support maps.</p>

<p>Here is the pretty-printed attribute value that Scanamo generates:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"M"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"seqNo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"N"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"S"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9e5fd6e9-65ef-472c-ad89-e5fe658f14c6"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"event"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"M"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Create"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"M"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:{</span><span class="w">
              </span><span class="nl">"S"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Something"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
</section></div></div></div></div><script src="/highlight/highlight.pack.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/sbt.min.js"></script><script src="/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash','sbt']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/js/search.js"></script><script src="/js/docs.js"></script></body></html>